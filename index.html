<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Anyway.MBTI Zoo</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Quicksand:wght@700&display=swap");

      :root {
        --bg-color: #fffdf5;
      }

      body {
        margin: 0;
        width: 100vw;
        height: 100vh;
        background-color: var(--bg-color);
        font-family: "Quicksand", "Microsoft YaHei", sans-serif;
        overflow: hidden;
        user-select: none;
        /* 这是一个可爱的空心圆圈鼠标指针 */
        cursor: url('data:image/svg+xml;utf8,<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="8" stroke="%23FF8888" stroke-width="2"/></svg>')
            12 12,
          auto;
      }

      /* 隐藏原有的 Header，什么都不留 */

      /* === 核心容器 === */
      .critter {
        position: absolute;
        width: 60px;
        height: 60px;
        will-change: transform;
        z-index: 10;
        /* 扩大一点点击区域，更好抓 */
        padding: 20px;
        margin: -20px;
      }

      /* === 视觉包裹层 (负责左右翻转) === */
      .visual-wrapper {
        width: 60px;
        height: 60px;
        position: relative;
        transition: transform 0.2s;
        /* 修正 pointer-events 以便父级能捕获hover */
        pointer-events: auto;
      }

      .facing-right {
        transform: scaleX(-1);
      }

      /* === 身体 (负责上下浮动 & 颜色) === */
      .body {
        width: 100%;
        height: 100%;
        border-radius: 45% 45% 40% 40%; /* 稍微圆一点 */
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        /* 默认阴影 */
        box-shadow: inset -3px -3px 10px rgba(0, 0, 0, 0.05),
          0 5px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); /* 弹性过渡 */
        z-index: 2;
      }

      /* 走路时的颠簸动画 */
      .critter.walking .body {
        animation: bob 0.6s infinite alternate ease-in-out;
      }
      @keyframes bob {
        0% {
          transform: translateY(0);
        }
        100% {
          transform: translateY(-6px);
        }
      }

      /* 表情文字 */
      .face {
        font-size: 16px;
        color: rgba(60, 60, 60, 0.7);
        font-weight: bold;
        pointer-events: none;
        transition: transform 0.1s;
      }

      /* === 腿部系统 === */
      .legs {
        position: absolute;
        bottom: -6px;
        width: 100%;
        height: 15px;
        display: flex;
        justify-content: center;
        gap: 12px;
        z-index: 1;
        pointer-events: none;
      }
      .leg {
        width: 6px;
        height: 10px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 4px;
        transition: all 0.2s;
      }

      /* 走路腿动 */
      .critter.walking .leg:nth-child(1) {
        animation: walk-l 0.4s infinite alternate;
      }
      .critter.walking .leg:nth-child(2) {
        animation: walk-r 0.4s infinite alternate;
        animation-delay: 0.2s;
      }
      @keyframes walk-l {
        from {
          transform: rotate(-20deg) translateY(0);
        }
        to {
          transform: rotate(20deg) translateY(-3px);
        }
      }
      @keyframes walk-r {
        from {
          transform: rotate(20deg) translateY(-3px);
        }
        to {
          transform: rotate(-20deg) translateY(0);
        }
      }

      /* === ✨ HOVER 特效：拎起来！ ✨ === */

      .critter:hover {
        z-index: 999;
        cursor: grab;
      }

      /* 1. 身体上浮，阴影变远 */
      .critter:hover .body {
        animation: none; /* 停止走路颠簸 */
        transform: translateY(-20px) scale(1.05); /* 向上提 */
        box-shadow: 0 30px 30px rgba(0, 0, 0, 0.15); /* 阴影拉长 */
        filter: brightness(1.05); /* 稍微变亮 */
      }

      /* 2. 腿变长并乱蹬 (悬空感) */
      .critter:hover .leg {
        animation: none;
        height: 22px; /* 腿被重力拉长 */
        width: 4px;
        animation: panic-legs 0.1s infinite alternate; /* 快速抖动 */
      }
      /* 乱蹬动画 */
      @keyframes panic-legs {
        from {
          transform: rotate(-15deg);
        }
        to {
          transform: rotate(15deg);
        }
      }
      .critter:hover .leg:nth-child(2) {
        animation-delay: 0.05s;
      }

      /* 3. 气泡显示 */
      .info-bubble {
        position: absolute;
        bottom: 90px; /* 气泡位置也稍微高一点 */
        left: 50%;
        transform: translateX(-50%) scale(1);
        background: rgba(50, 50, 50, 0.9);
        color: #fff;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        white-space: nowrap;
        opacity: 1;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        pointer-events: none;
        z-index: 99;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      .info-bubble::after {
        content: "";
        position: absolute;
        bottom: -4px;
        left: 50%;
        margin-left: -4px;
        border-width: 4px 4px 0;
        border-style: solid;
        border-color: rgba(50, 50, 50, 0.9) transparent transparent transparent;
      }
      .critter:hover .info-bubble {
        transform: translateX(-50%) scale(1.1);
      }

      .name-row {
        display: flex;
        align-items: center;
        gap: 5px;
      }
      .name {
        font-weight: 700;
        font-size: 14px;
      }
      .mbti-tag {
        font-size: 10px;
        background: rgba(255, 255, 255, 0.2);
        padding: 1px 5px;
        border-radius: 4px;
      }

      /* 形状变体 */
      .shape-triangle .body {
        border-radius: 15px;
        clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        height: 65px;
        width: 70px;
      }
      .shape-triangle .face {
        margin-top: 15px;
      }
      .shape-square .body {
        border-radius: 12px;
      }

      /* 地面线 */
      .floor-line {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 8px;
        background: repeating-linear-gradient(
          to right,
          #e0e0e0 0,
          #e0e0e0 10px,
          transparent 10px,
          transparent 20px
        );
        opacity: 0.6;
      }
    </style>
  </head>
  <body>
    <div id="zoo-container"></div>
    <div class="floor-line"></div>

    <script>
      // MBTI 类型配色方案
      const mbtiStyles = {
        INTJ: { color: "#957DAD", shape: "circle" },
        ENTJ: { color: "#E0BBE4", shape: "square" },
        INTP: { color: "#D291BC", shape: "circle" },
        ENTP: { color: "#D291BC", shape: "triangle" },
        INFJ: { color: "#B5EAD7", shape: "circle" },
        ENFJ: { color: "#FF9AA2", shape: "triangle" },
        INFP: { color: "#C7CEEA", shape: "circle" },
        ENFP: { color: "#FFB7B2", shape: "circle" },
        ISTJ: { color: "#FDFD96", shape: "square" },
        ESTJ: { color: "#FFDAC1", shape: "triangle" },
        ISTP: { color: "#FFA07A", shape: "circle" },
        ESTP: { color: "#FFDAC1", shape: "circle" },
        ISFJ: { color: "#E2F0CB", shape: "circle" },
        ESFJ: { color: "#E2F0CB", shape: "square" },
        ISFP: { color: "#DDA0DD", shape: "circle" },
        ESFP: { color: "#F0E68C", shape: "triangle" },
      };

      let characters = [];

      // 普通状态的表情
      const normalFaces = ["• ‿ •", "ovo", "¬_¬", "•_•", "^.^", "=.="];
      // 被抓起来时的表情 (惊讶/害羞)
      const panicFaces = [">///<", "O_O", "QAQ", ">3<", "⊙﹏⊙", "OwO", "!!"];

      const container = document.getElementById("zoo-container");

      class Critter {
        constructor(data) {
          this.data = data;
          this.element = null;
          this.wrapper = null;
          this.faceElement = null;
          this.originalFace = "";

          this.x = Math.random() * (window.innerWidth - 80);
          this.y = Math.random() * (window.innerHeight - 150) + 50;

          this.speed = 0.4 + Math.random() * 1.2; // 速度稍微慢一点，显呆
          this.dx = (Math.random() - 0.5) * this.speed;
          this.dy = (Math.random() - 0.5) * this.speed;

          this.isHovered = false;
          this.init();
        }

        init() {
          this.element = document.createElement("div");
          this.element.className = "critter walking";
          if (this.data.shape === "triangle")
            this.element.classList.add("shape-triangle");
          if (this.data.shape === "square")
            this.element.classList.add("shape-square");

          this.originalFace =
            normalFaces[Math.floor(Math.random() * normalFaces.length)];

          this.element.innerHTML = `
                    <div class="info-bubble">
                        <div class="name-row">
                            <span class="name">${this.data.name}</span>
                            <span class="mbti-tag">${this.data.type}</span>
                        </div>
                    </div>
                    <div class="visual-wrapper">
                        <div class="body" style="background-color: ${this.data.color};">
                            <div class="face">${this.originalFace}</div>
                        </div>
                        <div class="legs">
                            <div class="leg"></div>
                            <div class="leg"></div>
                        </div>
                    </div>
                `;

          container.appendChild(this.element);
          this.wrapper = this.element.querySelector(".visual-wrapper");
          this.faceElement = this.element.querySelector(".face");

          // === 交互逻辑 ===
          this.element.addEventListener("mouseenter", () => {
            this.isHovered = true;
            // 1. 随机换一个“惊慌”表情
            const panicFace =
              panicFaces[Math.floor(Math.random() * panicFaces.length)];
            this.faceElement.innerText = panicFace;
          });

          this.element.addEventListener("mouseleave", () => {
            this.isHovered = false;
            // 2. 恢复原来的淡定表情
            this.faceElement.innerText = this.originalFace;

            // 3. 被放下后，换个方向跑 (假装受惊逃跑)
            this.dx = (Math.random() - 0.5) * 3;
            this.dy = (Math.random() - 0.5) * 3;
          });
        }

        update() {
          if (this.isHovered) return; // 被抓住时，位置不动

          this.x += this.dx;
          this.y += this.dy;

          // 边界反弹
          if (this.x <= 20 || this.x >= window.innerWidth - 80) {
            this.dx *= -1;
          }
          if (this.y <= 20 || this.y >= window.innerHeight - 80) {
            this.dy *= -1;
          }

          // 偶尔发呆转向
          if (Math.random() < 0.005) {
            this.dx = (Math.random() - 0.5) * 1.5;
            this.dy = (Math.random() - 0.5) * 1.5;
          }

          // 移动
          this.element.style.transform = `translate(${this.x}px, ${this.y}px)`;

          // 转向 (控制内部wrapper)
          if (this.dx > 0) {
            this.wrapper.classList.add("facing-right");
          } else {
            this.wrapper.classList.remove("facing-right");
          }
        }
      }

      // 从 API 获取数据并初始化
      const critters = [];

      async function loadCharacters() {
        try {
          const response = await fetch("https://anyway.fm/api/mbti.php");
          const result = await response.json();

          // API 返回的数据在 result.data.items 里
          const items = result.data.items;

          // 转换 API 数据为我们需要的格式
          characters = items.map((person) => {
            const mbtiType = person.mbti.toUpperCase();
            const style = mbtiStyles[mbtiType] || {
              color: "#CCCCCC",
              shape: "circle",
            };

            return {
              name: person.nickname,
              type: mbtiType,
              color: style.color,
              shape: style.shape,
            };
          });

          // 初始化所有小生物
          characters.forEach((data) => critters.push(new Critter(data)));
        } catch (error) {
          console.error("Failed to load characters:", error);
        }
      }

      function animate() {
        critters.forEach((c) => c.update());
        requestAnimationFrame(animate);
      }

      // 启动
      loadCharacters();
      animate();

      window.addEventListener("resize", () => {
        critters.forEach((c) => {
          if (c.x > window.innerWidth) c.x = window.innerWidth - 100;
          if (c.y > window.innerHeight) c.y = window.innerHeight - 100;
        });
      });
    </script>
  </body>
</html>
